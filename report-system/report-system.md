# 接口报警系统

## 前言
在工作中经常会遇到这样的场景，用户保障页面空白或者某一操作失败，一般只会提示“请重新刷新”，“稍后重试”，“服务器故障”，而不会告诉用户具体接口的错误原因，导致保障时前端无法准确判别是哪个接口返回了什么错误码，而且从保障到反应到技术人员往往需要较长的时间。
因此需要一个可以及时收到用户因接口错误保障的信息（通过邮件通知是个不错的选择），并且能够准确知道是哪个接口出问题了，具体错误是什么。

## 前期准备
* 服务端使用`Node.js`，框架使用`Koa`
* 数据库使用`mongodb`
* 日志模块`log4js`
* 邮件模块`nodemailer`和`nodemailer-smtp-transport`

## 构建项目
首先使用[koa-generator](https://github.com/17koa/koa-generator)来构建项目。
### 1 安装koa-generator
在终端输入：
```
$ npm install -g koa-generator
```

### 2 使用koa-generator生成koa2项目
在工作目录下，输入：
```
$ koa2 reportSystem
```

成功创建项目后，进入项目目录，并执行`npm install`命令
```
$ cd reportSystem 
$ npm install
```

### 3 启动项目
在终端输入：
```
$ npm start
```
项目启动后，默认端口号是3000，会在浏览器自动打开一个页面，说明项目启动成功。

## 路由
要接受到错误信息，首先要提供在后端接口错误时请求的接口，把接口url、接口返回的错误码等信息作为接口的参数传送到我们的报警系统。

## 日志入库
把接受到的错误信息存储到数据库，日后可制作成图表，方便统计分析接口报警率，频发时段等信息。

## 报警条件
通过配置，可订阅接口，定时发邮件通知配置时间段内接口报警情况。
还可以在一段时间内接口报警次数超过配置阀值时发邮件通知。

## 发送邮件
把报警的信息制作成表格，发送至配置的邮箱。
